# PHP App ① レビュー

## 全般

### 以下のaタグのリンクを押下した際にedit.phpの$_GETにどんな値が格納されるか説明してください。

```html
<a href="edit.php?todo_id=123&todo_content=焼肉">更新</a>
```
- 下記のような連想配列が格納されています。
  ```PHP
  (
  'todo_id' => '123' ,
  'todo_content' => '焼肉'
  )
  ```


### 以下のフォームの送信ボタンを押下した際にstore.phpの$_POSTにどんな値が格納されるか説明してください。

```html
<form action="store.php" method="post">
    <input type="text" name="id" value="123">
    <textarea name="content">焼肉</textarea>
    <button type="submit">送信</button>
</form>
```
- name属性がキーとなり、value属性がバリューとなるような連想配列が格納される。
- 今回の場合、キーが"id"、バリューが"123"の連想配列と
- キーが"content"、バリューが"焼肉"が格納されます。

- 下記のような値が格納されます。
```php
[
  'id' => '123'
  'content' => '焼肉'
]
```


### `require_once()` は何のために記述しているか説明してください。
- ()内のファイルに記載されているものが使用できるようにするために記述しています。

### `savePostedData($post)`は何をしているか説明してください。
- `$path`にgetRefererPath関数で取得したリクエスト元のパスが代入され
swich文で条件分岐を定義しています。
条件の内容は、`$path`が`/new.php`だった場合、createTodoData関数を実行して
$pathが`/edit.php`だった場合、updateTodoData関数を実行する内容になっています。

### `header('location: ./index.php')`は何をしているか説明してください。
- ./index.htmlファイルに遷移します。

### `getRefererPath()`は何をしているか説明してください。
- getRefererPath()は何をしているか説明してください。
parse_url関数の引数を`$_SERVER['HTTP_REFERER']`にすることで
ユーザーが一つ前に開いていたURLを配列として取得し、`$urlArray`に代入します。
`$urlArray['path']`となっているので、配列のうちキーが`['path']`となっているバリューを
returnで返り値として取得しています。

### `connectPdo()` の返り値は何か、またこの記述は何をするための記述か説明してください。
- connectPdo() 関数はDBとの接続を表すPDOクラスをインスタンス化したものなので、
- 返り値はPDOクラスのオブジェクトになります。
- また、この記述をすることでDBとの接続が出来ます。

### `try catch`とは何か説明してください。
- プログラムの異常終了によって処理が継続できないというケースを防ぐための記述です。
- 「try」の｛｝内に例外が起こりそうな内容を記述することで
- 例外が起きた際に、そのあとに続く「catch」内に記述されている処理を実行します。

### Pdoクラスをインスタンス化する際に`try catch`が必要な理由を説明してください。
- PDOクラスはDBとの接続を表すクラスなので、try catchがなかった場合
- 何かしらの理由でDBに接続されなかった時に、プログラムが異常終了しないためにtry catchの記述が必要です。

## 新規作成

### `createTodoData($todoText)`は何をしているか説明してください。
- ①DBへの接続を表すPDOクラスをインスタンス化し「$dbh」に代入しています。
- ②「$sql」は「todosテーブル」に引数「$todoText」を値としたデータを追加します。
- ③最後にPDOクラスをインスタンス化しすることでDBに接続し、queryメゾットを用いて、SQL文を実行しています。

## 一覧

### `getTodoList()`の返り値について説明してください。
- 「functions.php」を確認すると「getAllRecords()」が返り値となっています。
- 「getAllRecords()」は「connection.php」から呼び出しているので確認してみると
- 返り値が「$sql」に記述したSQＬ文でDBから取り出した全ての配列(fatchAll())となっています。
- よって、getTodoList()の返り値について、最終的には”「$sql」に記述したSQＬ文でDBから取り出した全ての配列”となります。

### `<?= ?>`は何の省略形か説明してください。
```php
 <?php echo ; ?>
```

## 更新

### `getSelectedTodo($_GET['id'])`の返り値は何か、またなぜ`$_GET['id']` を引数に渡すのか説明してください。
- 返り値：引数に渡されたタスクの文字列
- `$_GET['id']`を引数に渡す理由：自動グローバル変数`$_GET`を使用することでURLパラメータとして送られた値を取得できるので、変更時に変更後の値を正しくDBに格納することが出来る。

### `updateTodoData($post)`は何をしているか説明してください。
<br>対象のタスクデータを入力された値に変更しています</br>
- 手順①`$dbh`にPDOクラスをインスタンス化したものを代入
- 手順②`$sql`に「todosテーブルのうち、引数で渡された連想配列`$post`のキー名が`['id']`の値とidカラムが同じデータに対して、contentカラムを連想配列`$post`のキー名が`['content']`の値に変更する」というSQL文を代入
- 手順④`$dbh`にqueryメソッドを用いてSQL文を実行する

## 削除

### `deleteTodoData($id)`は何をしているか説明してください。
<br>対象のデータに対し削除した日時を更新しています</br>
- 手順①`$dbh`にPDOクラスをインスタンス化したものを代入
- 手順②`$now`にdate関数で現在の日時を代入
- 手順③`$sql`に「todosテーブルのうち、引数で渡された`$id`とidカラムが同じデータに対して、deleted_atカラムを`$now`の値に更新する」というSQL文を代入
- 手順④`$dbh`にqueryメソッドを用いてSQL文を実行する

### `deleted_at`を現在時刻で更新すると一覧画面からToDoが非表示になる理由を説明してください。
- データを取得する際に、`SELECT * FROM todos WHERE deleted_at IS NULL`とし、「削除された日時データが存在していないデータを抽出する」条件になっているため、非表示になります。

### 今回のように実際のデータを削除せずに非表示にすることで削除されたように扱うことを〇〇削除というか。
- 論理削除

### 実際にデータを削除することを〇〇削除というか。
- 物理削除

### 前問のそれぞれの削除のメリット・デメリットについて説明してください。
<br>**<<論理削除のメリット・デメリット>>**</br>
- ○削除したデータを復元しやすい
- ○削除したデータも参照できる
- △管理するカラムを追加する必要がある
- △データが残り続けるので、容量が圧迫されパフォーマンスが低下する恐れがある

<br>**<<物理削除のメリット・デメリット>>**</br>
- ○データが蓄積しないので、容量が圧迫されない。
- ○管理するカラムがないので、コードを単純化できる
- △完全に削除してしまうので、復元が出来ない
